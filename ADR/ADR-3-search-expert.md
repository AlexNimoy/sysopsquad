# ADR-3: Извлечение назначения заявки в отдельную пакетную задачу

## Статус

Предложенный

## Контекст

Назначение заявки кажется проблематичным. Часто неправильный эксперт приходит, чтобы исправить что-то, о чем он ничего не знает. Иногда заявки не назначаются эксперту и навсегда теряются. Нам необходимо найти надежное решение этой проблемы.

## Решение

Поскольку назначение заявки подвержено частым изменениям, кажется хорошей идеей сделать его отдельным компонентом и тем самым улучшить модульность.

Один из вариантов - сделать его самостоятельным сервисом, который реагирует на события заявки и обрабатывает каждую новую заявку отдельно. Но это будет означать значительные ограничения в возможностях обработки.
Как насчет приоритетов заявки? Заявки с более высоким приоритетом могут требовать первоочередного назначения, откладывая более низкоприоритетные заявки. Это едва ли возможно, когда обрабатывается по заявке за раз.

Более лучшим решением будет сделать это пакетной задачей, которая запускается периодически (например, каждый час или даже один раз в день). Когда клиент отправляет заявку, он не ожидает, что эксперт будет ждать за дверью через минуту. **Даже срочные ситуации могут ждать несколько часов, менее срочные - дни.** Здесь важнее **надежность**, чем производительность.

Сделав это пакетной задачей, мы также сделаем компонент намного проще для тестирования и разработки, избавившись от необходимости поддерживать API.

Задача просто запускается по расписанию (как например cron-job), сканирует статусы заявок и создает назначения заявок. Она не принимает входящие запросы или события, поэтому ее единственная ответственность - назначать экспертов на заявки.

Это также повысит надежность, потому что проблема может быть решена повторным запуском задачи в случае неудачи.

## Последствия

Существует риск того, что задача не запустится из-за проблемы с конфигурацией или ошибки, поэтому потребуется дополнительный мониторинг.
