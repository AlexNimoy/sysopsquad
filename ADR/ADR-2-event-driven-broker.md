# ADR-2: Использование очередей сообщений с гарантированной доставкой для рабочего процесса по обработке заявок

## Статус

Предложено

## Контекст

Как указано в [ADR-1](ADR-1-service-based.md), службы, предоставляемые для клиентов, требуют особых мер по обеспечению доступности и масштабируемости в отношении остальной системы. Аналогичные требования к программному обеспечению, предназначенному для специалистов, заключаются в необходимости обеспечения высокой доступности подсистемы и более быстрого времени отклика по сравнению с остальной системой.
Это предполагает необходимость декуплирования этих областей друг от друга.

## Решение

Использование асинхронных очередей сообщений между службами для клиентов и службами Sysops обеспечивает следующие возможности:

- позволяет клиентам отправлять заявки и не ждать их обработки; таким образом, достигается очень низкое время отклика;
- аналогично для экспертов Sysops, им не нужно ждать окончания обработки заявки или генерации отчета; работая в поле, им просто нужно искать заявку или статью в базе знаний;
- обеспечивает независимую масштабируемость и доступность соответствующих квантов.

Если посмотреть на рабочий процесс по обработке заявок между областями, он естественно выглядит скорее как обмен сообщениями, а не как запрос-ответ, как показано на этой диаграмме BPMN (круги представляют сообщения):

![Рабочий процесс по обработке заявок](../images/bpmn-ticket-workflow.jpg 'Рабочий процесс по обработке заявок')

Обратите внимание, что мы должны гарантировать доставку сообщения в точное место назначения, поэтому это взаимодействие основано на передаче сообщений в очереди, а не на публикации-подписке на тему.

## Последствия

Давайте рассмотрим плюсы и минусы:

- увеличение сложности;
- очереди сообщений могут стать единой точкой отказа, поэтому их необходимо балансировать нагрузку;
- рабочий процесс по обработке заявок становится более сложным для тестирования и отладки.

Так как вышеуказанные качества притичны для бизнеса, мы принимаем эти плюсы и минусы.
